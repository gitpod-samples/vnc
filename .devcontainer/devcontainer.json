// The Dev Container format allows you to configure your environment. At the heart of it
// is a Docker image or Dockerfile which controls the tools available in your environment.
//
// See https://aka.ms/devcontainer.json for more information.
{
    "name": "KasmVNC Ona",
    // Use "image": "mcr.microsoft.com/devcontainers/base:ubuntu-24.04",
    // instead of the build to use a pre-built image.
    "build": {
        "context": ".",
        "dockerfile": "Dockerfile"
    },
    "features": {
        "ghcr.io/devcontainers/features/docker-in-docker:2": {}
    },
    "runArgs": [ "--shm-size=2gb" ], // Increase /dev/shm size for GUI applications that need it
    "privileged": true,
    "postStartCommand": {
        "vnc": "sudo service dbus start && cd $HOME && vncserver -disableBasicAuth -alwaysshared"
    },
    // Mount the Docker socket from the host to enable Docker-in-Docker functionality
    "mounts": [
        {
            "source": "/var/run/docker.sock",
            "target": "/var/run/docker.sock",
            "type": "bind"
        }
    ],
    "forwardPorts": [ 5901 ],
    "portsAttributes": {"5901": {"label": "KasmVNC"}}
}